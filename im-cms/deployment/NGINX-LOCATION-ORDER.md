# NGINX Location é…ç½®é¡ºåºè¯´æ˜

## âš ï¸ é‡è¦æé†’

NGINXçš„locationåŒ¹é…é¡ºåºéå¸¸é‡è¦ï¼æ›´å…·ä½“çš„è·¯å¾„å¿…é¡»æ”¾åœ¨æ›´é€šç”¨çš„è·¯å¾„ä¹‹å‰ã€‚

## ğŸ“‹ æ­£ç¡®çš„é…ç½®é¡ºåº

### 1. ç®¡ç†åå°æœåŠ¡ (ç«¯å£10009)

```nginx
# å…·ä½“è·¯å¾„åœ¨å‰
location /api/account { ... }
location /api/user/password { ... }
location /api/user/import { ... }
location /api/block { ... }
location /api/default { ... }
```

### 2. IMç³»ç»ŸæœåŠ¡ (ç«¯å£10002) - å…·ä½“è·¯å¾„

```nginx
# å¿…é¡»åœ¨ /api/user ä¹‹å‰ï¼
location /api/user/get_users { ... }
location /api/msg { ... }
location /api/group { ... }
location /api/auth { ... }
location /api/friend { ... }
location /api/third { ... }
location /api/object { ... }
```

### 3. ç”¨æˆ·æœåŠ¡ (ç«¯å£10008) - é€šç”¨è·¯å¾„

```nginx
# å¿…é¡»åœ¨æœ€åï¼Œå› ä¸ºä¼šåŒ¹é…æ‰€æœ‰ /api/user/* è·¯å¾„
location /api/user { ... }
```

### 4. é™æ€æ–‡ä»¶æœåŠ¡

```nginx
# æœ€é€šç”¨çš„è·¯å¾„ï¼Œå¿…é¡»åœ¨æœ€å
location / { ... }
```

## ğŸ” åŒ¹é…è§„åˆ™è¯´æ˜

### é—®é¢˜ç¤ºä¾‹

**é”™è¯¯çš„é…ç½®é¡ºåº**ï¼š
```nginx
location /api/user {          # âŒ ä¼šåŒ¹é… /api/user/get_users
    proxy_pass http://user_backend;
}
location /api/user/get_users { # âŒ æ°¸è¿œä¸ä¼šè¢«åŒ¹é…åˆ°
    proxy_pass http://im_backend;
}
```

**æ­£ç¡®çš„é…ç½®é¡ºåº**ï¼š
```nginx
location /api/user/get_users { # âœ… å…ˆåŒ¹é…å…·ä½“è·¯å¾„
    proxy_pass http://im_backend;
}
location /api/user {          # âœ… å†åŒ¹é…é€šç”¨è·¯å¾„
    proxy_pass http://user_backend;
}
```

## ğŸ“Š è·¯å¾„åŒ¹é…ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | è·¯å¾„æ¨¡å¼ | ç¤ºä¾‹ | è¯´æ˜ |
|--------|----------|------|------|
| 1 | ç²¾ç¡®åŒ¹é… | `location = /api/user` | åªåŒ¹é…å®Œå…¨ç›¸åŒçš„è·¯å¾„ |
| 2 | å‰ç¼€åŒ¹é…ï¼ˆå…·ä½“ï¼‰ | `location /api/user/get_users` | åŒ¹é…ä»¥è¯¥è·¯å¾„å¼€å¤´çš„è¯·æ±‚ |
| 3 | å‰ç¼€åŒ¹é…ï¼ˆé€šç”¨ï¼‰ | `location /api/user` | åŒ¹é…ä»¥è¯¥è·¯å¾„å¼€å¤´çš„è¯·æ±‚ |
| 4 | æ­£åˆ™åŒ¹é… | `location ~ ^/api/user/.*` | æŒ‰æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… |
| 5 | é€šç”¨åŒ¹é… | `location /` | åŒ¹é…æ‰€æœ‰è¯·æ±‚ |

## âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æŒ‰ä½¿ç”¨é¢‘ç‡æ’åº

å°†æœ€å¸¸ç”¨çš„æ¥å£æ”¾åœ¨å‰é¢ï¼š

```nginx
# é«˜é¢‘æ¥å£åœ¨å‰
location /api/msg { ... }
location /api/group { ... }
location /api/user { ... }

# ä½é¢‘æ¥å£åœ¨å
location /api/third { ... }
location /api/object { ... }
```

### 2. ä½¿ç”¨ç²¾ç¡®åŒ¹é…

å¯¹äºå®Œå…¨ç¡®å®šçš„è·¯å¾„ï¼Œä½¿ç”¨ç²¾ç¡®åŒ¹é…ï¼š

```nginx
# ç²¾ç¡®åŒ¹é…ï¼Œæ€§èƒ½æ›´å¥½
location = /api/user/get_users { ... }

# è€Œä¸æ˜¯
location /api/user/get_users { ... }
```

### 3. é¿å…ä¸å¿…è¦çš„æ­£åˆ™åŒ¹é…

```nginx
# å¥½çš„åšæ³•
location /api/msg { ... }

# é¿å…çš„åšæ³•ï¼ˆé™¤éå¿…è¦ï¼‰
location ~ ^/api/msg.* { ... }
```

## ğŸ› ï¸ é…ç½®éªŒè¯

### æµ‹è¯•è·¯å¾„åŒ¹é…

```bash
# æµ‹è¯•å…·ä½“è·¯å¾„
curl -I http://localhost/api/user/get_users
# åº”è¯¥è¿”å› IMç³»ç»ŸæœåŠ¡ (ç«¯å£10002)

# æµ‹è¯•é€šç”¨è·¯å¾„
curl -I http://localhost/api/user/search
# åº”è¯¥è¿”å› ç”¨æˆ·æœåŠ¡ (ç«¯å£10008)
```

### æ£€æŸ¥é…ç½®è¯­æ³•

```bash
# æ£€æŸ¥NGINXé…ç½®è¯­æ³•
sudo nginx -t

# æ£€æŸ¥é…ç½®å¹¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
sudo nginx -T
```

## ğŸ“ é…ç½®æ¨¡æ¿

```nginx
server {
    listen 80;
    server_name localhost;
    
    # ==================== ç®¡ç†åå°æœåŠ¡ (ç«¯å£10009) ====================
    # å…·ä½“è·¯å¾„åœ¨å‰
    location /api/account { ... }
    location /api/user/password { ... }
    location /api/user/import { ... }
    location /api/block { ... }
    location /api/default { ... }
    
    # ==================== IMç³»ç»ŸæœåŠ¡ (ç«¯å£10002) ====================
    # å…·ä½“è·¯å¾„ï¼Œå¿…é¡»åœ¨ /api/user ä¹‹å‰
    location /api/user/get_users { ... }
    location /api/msg { ... }
    location /api/group { ... }
    location /api/auth { ... }
    location /api/friend { ... }
    location /api/third { ... }
    location /api/object { ... }
    
    # ==================== ç”¨æˆ·æœåŠ¡ (ç«¯å£10008) ====================
    # é€šç”¨è·¯å¾„ï¼Œå¿…é¡»åœ¨æœ€å
    location /api/user { ... }
    
    # ==================== é™æ€æ–‡ä»¶æœåŠ¡ ====================
    # æœ€é€šç”¨è·¯å¾„ï¼Œå¿…é¡»åœ¨æœ€å
    location / { ... }
}
```

## âš ï¸ å¸¸è§é”™è¯¯

### 1. é¡ºåºé”™è¯¯

```nginx
# âŒ é”™è¯¯ï¼šé€šç”¨è·¯å¾„åœ¨å‰
location /api/user { ... }
location /api/user/get_users { ... }  # æ°¸è¿œä¸ä¼šåŒ¹é…
```

### 2. é‡å¤é…ç½®

```nginx
# âŒ é”™è¯¯ï¼šé‡å¤é…ç½®
location /api/user { ... }
location /api/user { ... }  # é‡å¤
```

### 3. å†²çªçš„åŒ¹é…è§„åˆ™

```nginx
# âŒ é”™è¯¯ï¼šå†²çªçš„åŒ¹é…
location /api/user { ... }
location ~ ^/api/user.* { ... }  # å¯èƒ½å†²çª
```

## ğŸ¯ æœ€ä½³å®è·µ

1. **å…·ä½“è·¯å¾„åœ¨å‰**ï¼šå°†æœ€å…·ä½“çš„è·¯å¾„æ”¾åœ¨æœ€å‰é¢
2. **é€šç”¨è·¯å¾„åœ¨å**ï¼šå°†é€šç”¨çš„è·¯å¾„æ”¾åœ¨æœ€å
3. **æŒ‰ä½¿ç”¨é¢‘ç‡æ’åº**ï¼šå°†é«˜é¢‘æ¥å£æ”¾åœ¨å‰é¢
4. **ä½¿ç”¨ç²¾ç¡®åŒ¹é…**ï¼šå¯¹äºå®Œå…¨ç¡®å®šçš„è·¯å¾„ä½¿ç”¨ `=`
5. **é¿å…æ­£åˆ™åŒ¹é…**ï¼šé™¤éå¿…è¦ï¼Œå¦åˆ™é¿å…ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼
6. **æµ‹è¯•éªŒè¯**ï¼šéƒ¨ç½²å‰æµ‹è¯•æ‰€æœ‰è·¯å¾„çš„åŒ¹é…æƒ…å†µ

è®°ä½ï¼šNGINXæŒ‰ç…§é…ç½®æ–‡ä»¶ä¸­locationå—çš„é¡ºåºè¿›è¡ŒåŒ¹é…ï¼Œç¬¬ä¸€ä¸ªåŒ¹é…çš„è§„åˆ™ä¼šè¢«ä½¿ç”¨ï¼
